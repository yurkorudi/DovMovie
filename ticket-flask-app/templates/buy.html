<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>{{ movie_data['title'] }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
</head>
<body>

  {% include 'header.html' %}

 <main class="booking-layout hide-scrollbar">


  <section class="film-info">
    <div class="poster">
      <img src="{{ movie_data['poster'] }}" alt="{{ movie_data['title'] }}">
        <a
      href="{{ movie_data['trailerLink'] }}"
      target="_blank"
      class="btn-trailer">
      Дивитись трейлер
    </a>
    </div>
    <div class="details">
      <h1>{{ movie_data['title'] }}</h1>
      <p><strong>Початок:</strong> {{ movie_data['start_time'] or 'невизначено' }}</p>
      <p><strong>Тривалість:</strong> {{ movie_data['duration'] }} хв</p>
      <p><strong>Ціна:</strong> {{ movie_data['price'] }} грн</p>
      <p>{{ movie_data['description'] }}</p>
    </div>
  </section>


  <section class="hall-wrapper">
    <div class="hall">
      <div class="screen">Екран</div>
      <div id="price-display" class="price-display"></div>
      <div id="seats"></div>
    </div>
  </section>
</main>


  {% include 'footer.html' %}


  <script>
  window.addEventListener('DOMContentLoaded', () => {

    const hallStructure = [
  [1,1,1,1,1,1,1,0,1,1,1,1,1,1],
  [1,1,1,1,1,1,1,0,1,1,1,1,1,1],
  [1,1,1,1,1,1,1,0,1,1,1,1,1,1],
  [1,1,1,1,1,1,1,0,1,1,1,1,1,1],
  [1,1,1,1,1,1,1,0,1,1,1,1,1,1],
  [1,1,1,1,1,1,1,0,1,1,1,1,1,1],
  [1,1,1,1,1,1,1,0,1,1,1,1,1,1],
  [1,1,1,1,1,1,1,0,1,1,1,1,1,1],
  [1,1,1,1,1,1,1,0,1,1,1,1,1,1],
  [1,1,1,1,1,1,1,0,1,1,1,1,1,1],
  [1,1,1,1,1,1,1,0,1,1,1,1,1,1],
  [1,1,1,1,3,2,1,0,1,1,1,1,1,1],
];

    const occupiedBySession = {{ occupied_seats|default([])|tojson }};
    const seatsEl          = document.getElementById('seats');
    const priceDisplay     = document.getElementById('price-display');


    const priceMap = {
      1: {{ session.price|default(100, true) }},
      2: 150,
      3: 200
    };

    function drawHall() {
      seatsEl.innerHTML = '';
      priceDisplay.textContent = '';

      const seatSize = 32;
      const gapSize  = 2;
      const cols     = Math.max(...hallStructure.map(r=>r.length));

      seatsEl.style.display             = 'inline-grid';
      seatsEl.style.gridAutoRows        = `${seatSize}px`;
      seatsEl.style.gap                 = `${gapSize}px`;
      seatsEl.style.gridTemplateColumns = `repeat(${cols}, ${seatSize}px)`;

      hallStructure.forEach((rowArr, r) => {
        rowArr.forEach((cell, c) => {
          if (cell === 0) {

            const gap = document.createElement('div');
            gap.className = 'seat-gap';
            seatsEl.appendChild(gap);
            return;
          }


          const div = document.createElement('div');
          div.className = `place type-${cell}`;
          div.dataset.row   = r;
          div.dataset.col   = c;
          div.dataset.price = priceMap[cell];


          const isOcc = occupiedBySession.some(o =>
            o.row === r && o.seatNumber === c
          );
          if (isOcc) {
            div.classList.add('occupied');
          } else {

            div.addEventListener('mouseover', () => {
              priceDisplay.textContent = `${div.dataset.price} ₴`;
            });
            div.addEventListener('mouseout', () => {
              priceDisplay.textContent = '';
            });

            div.addEventListener('click', () => {
              div.classList.toggle('selected');
              updateSelectedSeats();
            });
          }

          seatsEl.appendChild(div);
        });
      });
    }

    function updateSelectedSeats() {
      const selected = Array.from(seatsEl.querySelectorAll('.place.selected'));
      const arr = selected.map(el => ({
        row: +el.dataset.row,
        seatNumber: +el.dataset.col,
        cost: +el.dataset.price
      }));

      const input = document.getElementById('selectedSeatsInput');
      if (input) input.value = JSON.stringify(arr);

      const info = document.getElementById('selected-seats-info');
      info.innerHTML = '';
      arr.forEach((s,i) => {
        const d = document.createElement('div');
        d.className = 'selected-seat-info';
        d.innerHTML = `<p>Квиток ${i+1}: Ряд ${s.row+1}, Місце ${s.seatNumber+1}, ${s.cost}₴</p>`;
        info.appendChild(d);
      });
    }

    drawHall();
  });
  </script>
</body>
</html>
